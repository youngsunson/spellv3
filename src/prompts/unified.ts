// src/prompts/unified.ts

import { DocType, DOC_TYPE_CONFIG } from './core';

export interface UnifiedPromptOptions {
  text: string;
  docType: DocType;
  style?: 'sadhu' | 'cholito' | 'none' | '';
  tone?: string;
}

/**
 * рж╕ржм ржХрж┐ржЫрзБ ржПржХржЯрж┐ prompt-ржП - ржПржХржЯрж┐ API call
 */
export const buildUnifiedPrompt = (options: UnifiedPromptOptions): string => {
  const { text, docType, style, tone } = options;
  const docCfg = DOC_TYPE_CONFIG[docType];

  // Style instruction
  let styleInstruction = '';
  if (style && style !== 'none') {
    styleInstruction = style === 'sadhu'
      ? `\nЁЯФД рж╕рзНржЯрж╛ржЗрж▓: рж╕рж╛ржзрзБ рж░рзАрждрж┐рждрзЗ рж░рзВржкрж╛ржирзНрждрж░ ржХрж░рзБржи (ржЫрж┐тЖТрждрзЗржЫрж┐, рждрж╛рж░тЖТрждрж╛рж╣рж╛рж░)`
      : `\nЁЯФД рж╕рзНржЯрж╛ржЗрж▓: ржЪрж▓рж┐ржд рж░рзАрждрж┐рждрзЗ рж░рзВржкрж╛ржирзНрждрж░ ржХрж░рзБржи (рждрзЗржЫрж┐тЖТржЫрж┐, рждрж╛рж╣рж╛рж░тЖТрждрж╛рж░)`;
  }

  // Tone instruction
  const toneMap: Record<string, string> = {
    'formal': 'ржЖржирзБрж╖рзНржарж╛ржирж┐ржХ - ржЖржкржирж┐/ржЖржкржирж╛рж░ ржмрзНржпржмрж╣рж╛рж░',
    'informal': 'ржЕржирж╛ржирзБрж╖рзНржарж╛ржирж┐ржХ - рждрзБржорж┐/рждрзЛржорж╛рж░ ржмрзНржпржмрж╣рж╛рж░',
    'professional': 'ржкрзЗрж╢рж╛ржжрж╛рж░ - рж╕рзНржкрж╖рзНржЯ, ржЖрждрзНржоржмрж┐рж╢рзНржмрж╛рж╕рзА',
    'friendly': 'ржмржирзНржзрзБрждрзНржмржкрзВрж░рзНржг - ржЙрж╖рзНржг, ржЖржмрзЗржЧржкрзВрж░рзНржг',
    'respectful': 'рж╕ржорзНржорж╛ржиржЬржиржХ - ржмрж┐ржирзАржд, рж╢рзНрж░ржжрзНржзрж╛рж╕рзВржЪржХ',
    'persuasive': 'ржкрзНрж░ржнрж╛ржмрж╢рж╛рж▓рзА - рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА, ржЬрж░рзБрж░рж┐',
    'neutral': 'ржирж┐рж░ржкрзЗржХрзНрж╖ - ржмрж╕рзНрждрзБржирж┐рж╖рзНржа',
    'academic': 'рж╢рж┐ржХрзНрж╖рж╛ржорзВрж▓ржХ - ржкрж░рж┐ржнрж╛рж╖рж╛ ржпрзБржХрзНржд'
  };
  
  let toneInstruction = '';
  if (tone && toneMap[tone]) {
    toneInstruction = `\nЁЯОп ржЯрзЛржи: ${toneMap[tone]}`;
  }

  return `ржЖржкржирж┐ ржПржХржЬржи ржжржХрзНрж╖ ржмрж╛ржВрж▓рж╛ ржкрзНрж░рзБржлрж░рж┐ржбрж╛рж░ред
${docCfg.mainHint}${styleInstruction}${toneInstruction}

ржЯрзЗржХрзНрж╕ржЯ:
"""${text}"""

тЪая╕П ржирж┐ржпрж╝ржо:
тАв pos = 0-based word index (рж╕рзНржкрзЗрж╕ ржжрж┐ржпрж╝рзЗ ржнрж╛ржЧ ржХрж░рзЗ ржЧрзБржирзБржи)
тАв рж╢ржмрзНржж рж╣рзБржмрж╣рзБ ржЗржиржкрзБржЯ ржерзЗржХрзЗ ржХржкрж┐ ржХрж░рзБржи
тАв рж╢рзБржзрзБ ржирж┐рж╢рзНржЪрж┐ржд ржнрзБрж▓ ржзрж░рзБржиред ржирж╛ржо/ржмрзНрж░рзНржпрж╛ржирзНржб/ржЗржВрж░рзЗржЬрж┐ ржмрж╛ржж

ЁЯУд TOON ржлрж░ржорзНржпрж╛ржЯ (рж╢рзБржзрзБ ржПржЯрж┐, ржХрзЛржирзЛ ржмрзНржпрж╛ржЦрзНржпрж╛ ржиржпрж╝):

@SPELLING
ржнрзБрж▓|рж╕ржарж┐ржХрзз,рж╕ржарж┐ржХрзи|pos

@MIXING
detected:true/false
style:ржЪрж▓рж┐ржд/рж╕рж╛ржзрзБ
reason:ржХрж╛рж░ржг
@CORRECTIONS
ржмрж░рзНрждржорж╛ржи|рж╕ржВрж╢рзЛржзржи|ржЯрж╛ржЗржк|pos

@PUNCTUATION
issue:рж╕ржорж╕рзНржпрж╛
cur:ржмрж╛ржХрзНржп
fix:рж╕ржВрж╢рзЛржзрж┐ржд
exp:ржмрзНржпрж╛ржЦрзНржпрж╛
pos:0
---

@EUPHONY
рж╢ржмрзНржж|ржмрж┐ржХрж▓рзНржк|ржХрж╛рж░ржг|pos

${style && style !== 'none' ? `@STYLE
ржмрж░рзНрждржорж╛ржи|рж╕ржВрж╢рзЛржзрж┐ржд|ржХрзНрж░рж┐ржпрж╝рж╛ржкржж/рж╕рж░рзНржмржирж╛ржо|pos
` : ''}
${tone ? `@TONE
ржмрж░рзНрждржорж╛ржи|рж╕ржВрж╢рзЛржзрж┐ржд|ржХрж╛рж░ржг|pos
` : ''}
тЬЕ ржпрзЗ section-ржП ржХрж┐ржЫрзБ ржирзЗржЗ рж╕рзЗржЯрж┐ ржЦрж╛рж▓рж┐ рж░рж╛ржЦрзБржи`;
};
